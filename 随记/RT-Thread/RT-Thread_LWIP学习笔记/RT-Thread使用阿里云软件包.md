## 物模型

物模型是阿里云物联网平台为产品定义的数据模型，用于描述产品的功能。

#### 1.功能说明

物模型是物理空间中的实体（如传感器、车载装置、楼宇、工厂等）在云端的数字化表示，从**属性、服务和事件**三个维度，分别描述了该实体是什么、能做什么、可以对外提供哪些信息。定义了物模型的这三个维度，即完成了产品功能的定义。

| 功能类型         | 说明                                                         |
| :--------------- | :----------------------------------------------------------- |
| 属性（Property） | 用于描述设备运行时具体信息和状态。例如，环境监测设备所读取的当前环境温度、智能灯开关状态、电风扇风力等级等。属性可分为读写和只读两种类型。读写类型支持读取和设置属性值，只读类型仅支持读取属性值。 |
| 服务（Service）  | 指设备可供外部调用的指令或方法。服务调用中可设置输入和输出参数。输入参数是服务执行时的参数，输出参数是服务执行后的结果。相比于属性，服务可通过一条指令实现更复杂的业务逻辑，例如执行某项特定的任务。服务分为异步和同步两种调用方式。 |
| 事件（Event）    | 设备运行时，主动上报给云端的信息，一般包含需要被外部感知和处理的信息、告警和故障。事件中可包含多个输出参数。例如，某项任务完成后的通知信息；设备发生故障时的温度、时间信息；设备告警时的运行状态等。事件可以被订阅和推送。 |

物联网平台支持为产品定义多组功能（属性、服务和事件）。一组功能定义的集合，就是一个物模型模块。多个物模型模块，彼此互不影响。

#### 2.使用说明

物联网平台通过定义一种物的描述语言来描述物模型模块和功能，称为TSL（Thing Specification Language）。

物模型模块下定义的功能不需要同时包含属性、服务和事件，按需配置即可。

物模型TSL文件格式为JSON。您可在物联网平台控制台**产品详情**页面，单击**功能定义**页签，单击**物模型TSL**，查看或导出JSON格式的TSL。相关字段说明，请参见[物模型TSL字段说明](https://help.aliyun.com/document_detail/213902.htm#concept-2070735)。

物联网平台支持单个和批量添加物模型。批量导入时，您可自定义物模型TSL文件，编写要求，请参见下文[限制说明](https://help.aliyun.com/document_detail/73727.html#section-0zq-kxw-h3p)。

#### 3.限制说明

物模型功能定义限制，请参见[产品与设备的物模型功能定义](https://help.aliyun.com/document_detail/30527.htm#section-srj-k1v-4fb)。以下为批量导入物模型TSL文件时的使用限制。

| 使用方法          | 限制说明                                                     |
| :---------------- | :----------------------------------------------------------- |
| 单个物模型TSL文件 | 文件后缀名为`.json`；文件内容必须符合JSON格式；文件大小不能超过512 KB；文件中有效字符数量不能超过256 KB（256*1024个字符）。有效字符，指JSON格式内容中，除换行和对齐字符之外的字符。 |
| 多个物模型TSL文件 | 必须压缩为`.zip`格式文件，文件大小不能超过2.5 MB，且能够正常解压。解压后的每个文件，必须满足单个TSL文件的规范。压缩包文件中至少包含1个有效的物模型文件，最多包含1个默认模块物模型文件，9个自定义模块物模型文件。 |

---

## 数据上报位置(Geolocation)

物联网平台二维数据可视化服务支持设备定位，目前支持的定位方式有设备属性上报位置（Geolocation）、控制台设置经纬度和云端推理经纬度三种。本文主要介绍使用设备属性上报位置（Geolocation）方法为设备定位，即确定设备经纬度。

若设备具有GPS模组，则直接上报经纬度，此时使用设备属性上报位置（Geolocation）方法定位设备，具体操作请见下文。

#### 操作步骤

1. 在[物联网平台控制台](https://iot.console.aliyun.com/)，创建一个产品。详情请参见[创建产品](https://help.aliyun.com/document_detail/73728.html#task-lxd-pnl-vdb)。

   **说明** 若已为设备创建所属的产品，则无需重新创建。

2. 左侧导航栏选择设备管理 > 产品，在设备所属产品的右侧操作栏中单击查看。

3. 参考[单个添加物模型](https://help.aliyun.com/document_detail/88241.html#task-qhm-d3j-w2b)，在**产品详情**页面，选择**功能定义**页签，为产品添加标准功能。

   在系统弹出的**添加标准功能**对话框中，选择其他类型的功能，搜索`**地理位置**`。

4. 在搜索结果列表中单击需要的地理位置功能，则功能会添加到**已选功能**列表下，然后单击确定。

   ![自定义功能](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/7780386851/p44087.png)

   如果您不想按标准属性添加地理位置，可以在**产品详情**页面**功能定义**页签**自定义功能**区域框中添加如下配置。

   **说明** 建议您选择标准功能，为设备所属产品添加地理位置属性。

   ![自定义功能](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/7780386851/p44089.png)

   放大查看

   | 功能名称         | 标识符                 | 数据类型                                                     | JSON对象参数标识符 | 参数数据类型 | 参数解释                               |
   | :--------------- | :--------------------- | :----------------------------------------------------------- | :----------------- | :----------- | :------------------------------------- |
   | 地理位置         | GeoLocation            | struct（结构体）                                             | Longitude          | double       | 自定义设置，用于上报地理位置中的经度。 |
   | Latitude         | double                 | 自定义设置，用于上报地理位置中的纬度。                       |                    |              |                                        |
   | Altitude         | double                 | 自定义设置，用于上报地理位置中的高度。                       |                    |              |                                        |
   | CoordinateSystem | enum1：WGS_842：GCJ_02 | 自定义一个坐标系统，为了描述或确定位置，必须建立坐标系统，坐标只有存在于某个坐标系统才有实际的意义与具体的位置。以下是两种不同类型的坐标类型：WGS_84：国际经纬度坐标标准。GCJ_02：由国测局制定，是对地理位置进行首次加密后的一种坐标类型。 |                    |              |                                        |

   **说明**

   - 自定义设置以上JSON对象时，经度、纬度和坐标系统必须定义，高度可以根据实际情况进行添加或删除。经度、纬度子参数的属性名L必须大写，坐标系统的C必须大写。
   - 如果以上四个参数您都定义了，则上报数据里时就必须包含这四个参数的数据。

5. 设备会通过标准的设备协议上报位置到云端。

   设备上报协议：

   - TOPIC：`/sys/{productKey}/{deviceName}/thing/event/property/post`
   - REPLY TOPIC：`/sys/{productKey}/{deviceName}/thing/event/property/post_reply`

   请求示例如下所示。

   放大查看复制代码

   ```
   {
       "id" : "123",
       "version":"1.0",
       "params" : {
           "GeoLocation" : {
               "value":{
                   "Longitude":39.9935723,
                   "Latitude":39.9935723,
                   "Altitude":39.9935723,
                   "CoordinateSystem":2
               }    
           }
       },
       "method":"thing.event.property.post"  
   }
   ```

   关于上报设备信息的详细说明请参见[设备属性、事件、服务](https://help.aliyun.com/document_detail/89301.html#concept-mvc-4tw-y2b)。

#### 具体设置参数

| 参数名称 |      标识符      | 数据类型 |                           取值范围                           | 步长 | 单位 |
| :------: | :--------------: | :------: | :----------------------------------------------------------: | :--: | :--: |
|   经度   |    Longitude     |  double  |                           -180~180                           | 0.01 | 度/° |
|   纬度   |     Latitude     |  double  |                            -90~90                            | 0.01 | 度/° |
|   海拔   |     Altitude     |  double  |                            0~9999                            | 0.01 | 米/m |
| 坐标系统 | CoordinateSystem |   enum   | 1~WGS_84(国际经纬度坐标标准) <br />2~GCJ_02(国测局制定加密坐标类型) |      |      |

